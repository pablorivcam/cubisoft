<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:include="fragments/header :: header" />
<body>
	<header class="header" th:include="fragments/menu :: menu" /></header>
   
	<section id="main-section" class="container-fluid">
	
		<div th:if="${error_message != null}">
			<p class="alert alert-danger" role="alert" th:if="${!sucess}" th:text="${error_message}">Error message</p>
			<p class="alert alert-success" role="alert" th:if="${sucess}" th:text="${error_message}">Error message</p>
      	</div>
		
	 <h1 th:text="#{title.yourfollowsposts}">Your follows posts</h1>
	 <table class="table table-striped display dataTable">
	 	<tr th:each="post : ${followsPosts}">
		<td>
            	<!-- Parte de la visualización de la imagen -->
            	<div  style="width:400px; margin-left:25%">
	  				<div>
	            		            	
	            		<img th:src="@{'/Pictures/' + ${post?.picture.image_path}}" width="400px"/>
	            		<br/><hr style="margin:5px"/>
	            	</div>
	            	<div style="width:80%">
	            		<div>
	            			<span>Views: </span> 
	              			<span th:text="${post?.views}">Views placeholder</span>
							<div th:if="${post?.reshare}" style ="display:inline-block; padding: 5px" >
								<span>Reshared</span>
							</div>  	              			
						</div>
						<div>
							<div style ="display:inline-block;">
								<span>Likes: </span> 
		              			<span th:text="${post?.number_of_likes}">Likes placeholder</span>	          	
	              			</div>
	              				<div th:if="!${likesService.existLikes(currentUser,post)}" style ="display:inline-block; padding: 5px" >
									<!-- Boton de Like -->
									<form id="likePostForm" action="#" th:action="@{/followsPost/likePost}" class="form-narrow form-horizontal" method="post">
										<input type="hidden" id="like-postId" name="postId" th:value="${post?.post_id}">
										<button th:text="#{button.like}" type="submit" class="btn btn-danger">Like</button>
									</form>
								</div >
								<div th:if="${likesService.existLikes(currentUser,post)}" style ="display:inline-block; padding: 5px;">
									<!-- Boton de Unlike -->
									<form id="unlikePostForm" action="#" th:action="@{/followsPost/unlikePost}" class="form-narrow form-horizontal" method="post" >
										<input type="hidden" id="unlike-postId" name="postId" th:value="${post?.post_id}">
										<button th:text="#{button.unlike}" type="submit" class="btn btn-danger">Unlike</button>
									</form>
								</div>
								<a href="#resharePictureModal" 
									th:attr="data-postid=''+${post?.post_id}+''"						
									th:text="#{button.reshare}" data-toggle="modal" class="resharePictureModalButton btn btn-danger" role="button" style="margin:10px">Reshare</a>								
						</div>
	            		<div>
	            			<p>
	            			<span>Description: </span>
		      				<span th:text="${post?.picture.description}">Description placeholder</span>
		      				</p>
	            		</div>
           	
	           		</div>
           		</div>
         		
            </td> 
         </tr> 
      </table>
   </section>
   
   <!-- Parte del diálogo para reshares -->   
	<div class="modal fade" id="resharePictureModal" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="resharePictureModalLabel" th:text="#{title.post.reshare}">Reshare post</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
						<p th:text="#{label.reshareconfirmation}">Confirmation</p>
						<span id="modal-pictureid"></span> 
				</div>
				<div class="modal-footer">
					<form id="resharePictureForm" action="#" th:action="@{/followsPost/resharePost}" class="form-narrow form-horizontal" method="post">
						<input type="hidden" id="postId" name="postId" value="-1">
						<button th:text="#{button.cancel}" type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>	
						<button th:text="#{button.submit}" type="submit" class="btn btn-danger">Submit</button>
					</form>							
				</div>
			</div>
		</div>
	</div>
   
   
	<footer>
      <div th:include="fragments/scripts :: general" />
   </footer>
   
   	<!-- Script para configurar el modal para todos los posibles botones de reshare -->
	<script type="text/javascript">
			
		$(document).ready(function() {
			
			// Cada vez que se haga click en algún botón de reshare
			$(document).on("click", ".resharePictureModalButton", function () {
				
				// Se recoje su valor de data-postId
	    		var postId = $(this).data('postid');

				// Y se usa en el campo oculto del formulario del modal
	        	$("#postId").val( postId );

			});
		});
	
	</script>   
</body>
</html>