<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:include="fragments/header :: header" />
<body>

	<header class="header" th:include="fragments/menu :: menu" />

	<section id="main-section" class="container-fluid">
		
		<div th:if="${error_message != null}">
			<p class="alert alert-danger" role="alert" th:if="${!sucess}" th:text="${error_message}">Error message</p>
			<p class="alert alert-success" role="alert" th:if="${sucess}" th:text="${error_message}">Error message</p>
      	</div>
      	
      <h1 th:text="#{title.yourpictures}">Your pictures</h1>
      <table class="table table-striped display dataTable">
         <tr th:each="picture : ${pictures}">
            <td>
            	<!-- Parte de la visualización de la imagen -->
            	<div  style="width:400px; margin-left:25%">
	            	<div>
	            		            	
	            		<img th:src="@{'/Pictures/' + ${picture?.image_path}}" width="400px"/>
	            		<br/><hr style="margin:5px"/>
	            	</div>
	            	<div style="width:80%">
						<div>
							<a href="#deletePictureModal" 
							th:attr="data-pictureid=''+${picture?.picture_id}+'', data-picturepath=''+${picture?.image_path}+''"							
							th:text="#{button.delete}" data-toggle="modal" class="deletePictureModalButton btn btn-danger" role="button" style="margin:10px">Delete</a>
							<a href="#modifyPictureModal" 
							th:attr="data-modifyid=''+${picture?.picture_id}+''"						
							th:text="#{button.modify}" data-toggle="modal" class="modifyPictureModalButton btn btn-danger" role="button" style="margin:10px">Modify</a>
						</div>

	            		<div style="margin-left:5%">
		      				<span th:text="${picture?.description}">Description placeholder</span>
	            		</div>
           	
	           		</div>
           		</div>
         		
            </td> 
         </tr> 
      </table>
   </section>

	<!-- Parte del diálogo de eliminar la imagen -->   
	<div class="modal fade" id="deletePictureModal" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="deletePictureModalLabel" th:text="#{title.picture.delete}">Delete Picture</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
						<p th:text="#{label.confirmation}">Confirmation</p>
						<span id="modal-pictureid"></span> 
				</div>
				<div class="modal-footer">
					<form id="deletePictureForm" action="#" th:action="@{/picture/deletePicture}" class="form-narrow form-horizontal" method="post">
						<input type="hidden" id="pictureId" name="pictureId" value="-1">
						<input type="hidden" id="picturePath" name="picturePath" value="null">					
						<button th:text="#{button.cancel}" type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>	
						<button th:text="#{button.delete}" type="submit" class="btn btn-danger">Delete</button>
					</form>							
				</div>
			</div>
		</div>
	</div>
	
		<!-- Parte del diálogo de modificar la imagen -->   
	<div class="modal fade" id="modifyPictureModal" tabindex="-2" role="dialog" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="modifyPictureModalLabel" th:text="#{title.picture.modify}">Modify description</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p th:text="#{label.newdescription}">New description</p>
					<form id="modifyPictureForm" action="#" th:action="@{/picture/modifyPicture}" class="form-narrow form-horizontal" method="post">
						<input type="hidden" id="modifyId" name="modifyId" value="-1">				
						<input type="text" class="form-control" id="description" name="description" placeholder="Picture Description" />
						<button th:text="#{button.cancel}" type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>	
						<button th:text="#{button.submit}" type="submit" class="btn btn-danger">Submit</button>	
					</form>						        
			            
				</div>
			</div>
		</div>
	</div>  
	  
	<!-- Si la petición es rechazada volvemos a esta página con el código de error en la url el cual se traduce en que tiene que lanzarse un mensaje si o si (por pantalla o diálogo)-->
   <footer>
      <div th:include="fragments/scripts :: general" />
   </footer>

	<!-- Script para configurar el modal para todos los posibles botones de delete -->
	<script type="text/javascript">
			
		$(document).ready(function() {
			
			// Cada vez que se haga click en algún botón de eliminar
			$(document).on("click", ".deletePictureModalButton", function () {
				
				// Se recoje su valor de data-pictureId
	    		var pictureId = $(this).data('pictureid');
	    		var picturePath = $(this).data('picturepath');

				// Y se usa en el campo oculto del formulario del modal
	        	$("#pictureId").val( pictureId );
	        	$("#picturePath").val( picturePath );

			});
			
			// Cada vez que se haga click en algún botón de modificar
			$(document).on("click", ".modifyPictureModalButton", function () {
				
				// Se recoje su valor de data-pictureId
	    		var modifyId = $(this).data('modifyid');

				// Y se usa en el campo oculto del formulario del modal
	        	$("#modifyId").val( modifyId );

			});
		});
	
	</script>   
</body>

</html>
